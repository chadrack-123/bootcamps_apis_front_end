<!-- public/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bootcamp APIs Widgets</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.0.3/tailwind.min.css">
</head>
<body class="bg-gray-100 p-10">
    <div class="container mx-auto space-y-10">
        <!-- Words Widget -->
        <div class="bg-white p-6 rounded shadow" x-data="wordsWidget()">
            <h2 class="text-2xl font-bold mb-4">Words Widget</h2>
            <input type="text" x-model="sentence" placeholder="Enter a sentence" class="border p-2 w-full mb-4" />
            <button @click="analyzeSentence()" class="bg-blue-500 text-white px-4 py-2 rounded">Analyze Sentence</button>

            <div x-show="stats" class="mt-4">
                <p><strong>Sentence:</strong> <span x-text="sentence"></span></p>
                <p><strong>Longest Word Length:</strong> <span x-text="stats.longestWord"></span></p>
                <p><strong>Shortest Word:</strong> <span x-text="stats.shortestWord"></span></p>
                <p><strong>Sum of Word Lengths:</strong> <span x-text="stats.sum"></span></p>
            </div>
        </div>

        <!-- Phone Bill Widget -->
        <div class="bg-white p-6 rounded shadow" x-data="phoneBillWidget()">
            <h2 class="text-2xl font-bold mb-4">Phone Bill Widget</h2>
            <div class="mb-4">
                <input type="text" x-model="billInput" placeholder="Enter usage (e.g., call,sms,call)" class="border p-2 w-full mb-2" />
                <button @click="calculateTotal()" class="bg-green-500 text-white px-4 py-2 rounded">Calculate Total</button>
                <div x-show="total" class="mt-2">
                    <p><strong>Total Cost:</strong> R<span x-text="total"></span></p>
                </div>
            </div>

            <div class="border-t pt-4 mt-4">
                <h3 class="text-xl font-bold mb-2">Update Prices</h3>
                <div class="flex space-x-4 mb-2">
                    <div>
                        <label class="block mb-1">Call Price (Current: R<span x-text="prices.call"></span>)</label>
                        <input type="number" step="0.01" x-model="newCallPrice" class="border p-2 w-full" />
                    </div>
                    <div>
                        <label class="block mb-1">SMS Price (Current: R<span x-text="prices.sms"></span>)</label>
                        <input type="number" step="0.01" x-model="newSmsPrice" class="border p-2 w-full" />
                    </div>
                </div>
                <button @click="updatePrices()" class="bg-yellow-500 text-white px-4 py-2 rounded">Update Prices</button>
            </div>
        </div>

        <!-- Enough Airtime Widget -->
        <div class="bg-white p-6 rounded shadow" x-data="enoughAirtimeWidget()">
            <h2 class="text-2xl font-bold mb-4">Enough Airtime Widget</h2>
            <input type="text" x-model="usage" placeholder="Enter usage (e.g., call,sms,data)" class="border p-2 w-full mb-2" />
            <input type="number" step="0.01" x-model="available" placeholder="Available Airtime" class="border p-2 w-full mb-4" />
            <button @click="checkAirtime()" class="bg-purple-500 text-white px-4 py-2 rounded">Check Airtime</button>
            <div x-show="result" class="mt-4">
                <p><strong>Remaining Balance:</strong> <span x-text="result"></span></p>
            </div>
        </div>
    </div>

    <script>
        function wordsWidget() {
            return {
                sentence: '',
                stats: null,
                analyzeSentence() {
                    if (this.sentence.trim() === '') {
                        alert('Please enter a sentence.');
                        return;
                    }
                    fetch(`/api/word_game?sentence=${encodeURIComponent(this.sentence)}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                alert(data.error);
                            } else {
                                this.stats = data;
                            }
                        })
                        .catch(error => console.error('Error:', error));
                }
            }
        }

        function phoneBillWidget() {
            return {
                billInput: '',
                total: null,
                prices: { call: 2.75, sms: 0.65 },
                newCallPrice: '',
                newSmsPrice: '',
                init() {
                    this.getPrices();
                },
                getPrices() {
                    fetch('/api/phonebill/prices')
                        .then(response => response.json())
                        .then(data => {
                            this.prices = data;
                        })
                        .catch(error => console.error('Error:', error));
                },
                calculateTotal() {
                    if (this.billInput.trim() === '') {
                        alert('Please enter usage.');
                        return;
                    }
                    fetch('/api/phonebill/total', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ bill: this.billInput })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                alert(data.error);
                            } else {
                                this.total = data.total;
                            }
                        })
                        .catch(error => console.error('Error:', error));
                },
                updatePrices() {
                    const updates = [];
                    if (this.newCallPrice) {
                        updates.push(fetch('/api/phonebill/price', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ type: 'call', price: parseFloat(this.newCallPrice) })
                        }));
                    }
                    if (this.newSmsPrice) {
                        updates.push(fetch('/api/phonebill/price', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ type: 'sms', price: parseFloat(this.newSmsPrice) })
                        }));
                    }
                    Promise.all(updates)
                        .then(() => {
                            alert('Prices updated successfully.');
                            this.newCallPrice = '';
                            this.newSmsPrice = '';
                            this.getPrices();
                        })
                        .catch(error => console.error('Error:', error));
                }
            }
        }

        function enoughAirtimeWidget() {
            return {
                usage: '',
                available: '',
                result: null,
                checkAirtime() {
                    if (this.usage.trim() === '' || this.available === '') {
                        alert('Please enter usage and available airtime.');
                        return;
                    }
                    fetch('/api/enough', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ usage: this.usage, available: parseFloat(this.available) })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                alert(data.error);
                            } else {
                                this.result = data.result;
                            }
                        })
                        .catch(error => console.error('Error:', error));
                }
            }
        }
    </script>
</body>
</html>
